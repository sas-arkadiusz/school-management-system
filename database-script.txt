/*
Created: 2018-11-03
Modified: 2018-11-03
Model: Logical model
Database: PostgreSQL 10
*/


-- Create functions section -------------------------------------------------

CREATE FUNCTION "Inheritance_TEACHER"()
RETURNS trigger
 LANGUAGE 'plpgsql'
 VOLATILE
AS
$$
declare numrows integer;
begin
  select count(*) into numrows
  from "ADMINISTRATION"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "ADMINISTRATION". Cannot insert.';
  end if;
  select count(*) into numrows
  from "MAINTENANCE"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "MAINTENANCE". Cannot insert.';
  end if;
return new;
end;
$$
;

CREATE FUNCTION "Inheritance_ADMINISTRATION"()
RETURNS trigger
 LANGUAGE 'plpgsql'
 VOLATILE
AS
$$
declare numrows integer;
begin
  select count(*) into numrows
  from "MAINTENANCE"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "MAINTENANCE". Cannot insert.';
  end if;
  select count(*) into numrows
  from "TEACHER"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "TEACHER". Cannot insert.';
  end if;
return new;
end;
$$
;

CREATE FUNCTION "Inheritance_MAINTENANCE"()
RETURNS trigger
 LANGUAGE 'plpgsql'
 VOLATILE
AS
$$
declare numrows integer;
begin
  select count(*) into numrows
  from "ADMINISTRATION"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "ADMINISTRATION". Cannot insert.';
  end if;
  select count(*) into numrows
  from "TEACHER"
  where "EMPLOYEE_ID" = new."EMPLOYEE_ID";
  if (numrows > 0) then
    raise exception 'Exclusive Inheritance violation with table "TEACHER". Cannot insert.';
  end if;
return new;
end;
$$
;

-- Create tables section -------------------------------------------------

-- Table TEACHER

CREATE TABLE "TEACHER"(
 "EMPLOYEE_ID" Bigint NOT NULL UNIQUE,
 "SURNAME" Text NOT NULL,
 "NAME" Text NOT NULL,
 "DATE_OF_BIRTH" Date NOT NULL,
 "SALARY" Bigint NOT NULL,
 "CAREER_LADDER" Text NOT NULL,
 "EMPLOYEE_SUPERVISOR_ID" Bigint,
	CONSTRAINT EMPLOYEE_SUPERVISOR FOREIGN KEY("EMPLOYEE_SUPERVISOR_ID")
	REFERENCES"TEACHER"("EMPLOYEE_ID"));

-- Add keys for table TEACHER

ALTER TABLE "TEACHER" ADD CONSTRAINT "Unique_Identifier2" PRIMARY KEY ("EMPLOYEE_ID")
;

-- Create triggers for table TEACHER

CREATE TRIGGER "Inheritance_TEACHER"
  BEFORE INSERT
  ON "TEACHER"
 FOR EACH ROW
 EXECUTE PROCEDURE "Inheritance_TEACHER"()
;

-- Table ADMINISTRATION

CREATE TABLE "ADMINISTRATION"(
 "EMPLOYEE_ID" Bigint NOT NULL,
 "SURNAME" Text NOT NULL,
 "NAME" Text NOT NULL,
 "DATE_OF_BIRTH" Date NOT NULL,
 "SALARY" Bigint NOT NULL,
 "POSITION" Text NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table ADMINISTRATION

ALTER TABLE "ADMINISTRATION" ADD CONSTRAINT "Unique_Identifier3" PRIMARY KEY ("EMPLOYEE_ID")
;

-- Create triggers for table ADMINISTRATION

CREATE TRIGGER "Inheritance_ADMINISTRATION"
  BEFORE INSERT
  ON "ADMINISTRATION"
 FOR EACH ROW
 EXECUTE PROCEDURE "Inheritance_ADMINISTRATION"()
;

-- Table MAINTENANCE

CREATE TABLE "MAINTENANCE"(
 "EMPLOYEE_ID" Bigint NOT NULL,
 "SURNAME" Text NOT NULL,
 "NAME" Text NOT NULL,
 "DATE_OF_BIRTH" Date NOT NULL,
 "SALARY" Bigint NOT NULL,
 "POSITION" Text NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table MAINTENANCE

ALTER TABLE "MAINTENANCE" ADD CONSTRAINT "Unique_Identifier4" PRIMARY KEY ("EMPLOYEE_ID")
;

-- Create triggers for table MAINTENANCE

CREATE TRIGGER "Inheritance_MAINTENANCE"
  BEFORE INSERT
  ON "MAINTENANCE"
 FOR EACH ROW
 EXECUTE PROCEDURE "Inheritance_MAINTENANCE"()
;

-- Table TRAINING_COMPLETED

CREATE TABLE "TRAINING_COMPLETED"(
 "TRAINING_NAME" Text NOT NULL,
 "TRAINING_DATE" Date NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table TRAINING_COMPLETED

ALTER TABLE "TRAINING_COMPLETED" ADD CONSTRAINT "Unique_Identifier5" PRIMARY KEY ("TRAINING_NAME")
;

-- Table TEACHER_TRAINING

CREATE TABLE "TEACHER_TRAINING"(
 "TRAINING_NAME" Text NOT NULL,
 "EMPLOYEE_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table TEACHER_TRAINING

CREATE INDEX "IX_TEACHER_TO_TRAINING" ON "TEACHER_TRAINING" ("EMPLOYEE_ID")
;

CREATE INDEX "IX_TRAINING_TO_TEACHER" ON "TEACHER_TRAINING" ("TRAINING_NAME")
;

-- Table EMPLOYEE_ADDRESS

CREATE TABLE "EMPLOYEE_ADDRESS"(
 "LOCALITY" Text NOT NULL,
 "POSTCODE" Text NOT NULL,
 "STREET" Text NOT NULL,
 "NO" Text NOT NULL,
 "EMPLOYEE_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table EMPLOYEE_ADDRESS

CREATE INDEX "IX_Relationship2" ON "EMPLOYEE_ADDRESS" ("EMPLOYEE_ID")
;

CREATE INDEX "IX_Relationship3" ON "EMPLOYEE_ADDRESS" ("EMPLOYEE_ID")
;

CREATE INDEX "IX_Relationship4" ON "EMPLOYEE_ADDRESS" ("EMPLOYEE_ID")
;

-- Table STUDENT

CREATE TABLE "STUDENT"(
 "STUDENT_ID" Bigint NOT NULL,
 "SURNAME" Text NOT NULL,
 "NAME" Text NOT NULL,
 "DATE_OF_BIRTH" Date NOT NULL,
 "FORM" Text NOT NULL,
 "STIPEND" Boolean NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table STUDENT

ALTER TABLE "STUDENT" ADD CONSTRAINT "Unique_Identifier8" PRIMARY KEY ("STUDENT_ID")
;

-- Table STUDENT_ADDRESS

CREATE TABLE "STUDENT_ADDRESS"(
 "LOCALITY" Text NOT NULL,
 "POSTCODE" Text NOT NULL,
 "STREET" Text NOT NULL,
 "NO" Text NOT NULL,
 "STUDENT_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table STUDENT_ADDRESS

CREATE INDEX "IX_Relationship1" ON "STUDENT_ADDRESS" ("STUDENT_ID")
;

-- Table CHARGE

CREATE TABLE "CHARGE"(
 "CHARGE_ID" Bigint NOT NULL,
 "AMOUNT_WITHOUT_INTEREST" Bigint NOT NULL,
 "INTEREST" Bigint NOT NULL,
 "PAYMENT_DATE" Date NOT NULL,
 "DESCRIPTION" Text NOT NULL,
 "STUDENT_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table CHARGE

CREATE INDEX "IX_PAYS" ON "CHARGE" ("STUDENT_ID")
;

-- Add keys for table CHARGE

ALTER TABLE "CHARGE" ADD CONSTRAINT "Unique_Identifier10" PRIMARY KEY ("CHARGE_ID")
;

-- Table FINAL_ASSESSMENT

CREATE TABLE "FINAL_ASSESSMENT"(
 "MATH" Bigint NOT NULL,
 "CHEMISTRY" Bigint NOT NULL,
 "HISTORY" Bigint NOT NULL,
 "ENGLISH" Bigint NOT NULL,
 "POLISH" Bigint NOT NULL,
 "PHYSICS" Bigint NOT NULL,
 "IT" Bigint NOT NULL,
 "STUDENT_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table FINAL_ASSESSMENT

ALTER TABLE "FINAL_ASSESSMENT" ADD CONSTRAINT "Unique_Identifier11" PRIMARY KEY ("STUDENT_ID")
;

-- Table SUBJECT

CREATE TABLE "SUBJECT"(
 "SUBJECT_ID" Bigint NOT NULL,
 "SUBJECT_NAME" Text NOT NULL,
 "CLASSROOM_ID" Bigint NOT NULL,
 "EMPLOYEE_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table SUBJECT

CREATE INDEX "IX_LEADS" ON "SUBJECT" ("EMPLOYEE_ID")
;

CREATE INDEX "IX_HELDS_SUBJECT" ON "SUBJECT" ("CLASSROOM_ID")
;

-- Add keys for table SUBJECT

ALTER TABLE "SUBJECT" ADD CONSTRAINT "Unique_Identifier12" PRIMARY KEY ("SUBJECT_ID")
;

-- Table STUDENT_SUBJECT

CREATE TABLE "STUDENT_SUBJECT"(
 "STUDENT_ID" Bigint NOT NULL,
 "SUBJECT_ID" Bigint NOT NULL,
 "FINAL_ASSESSMENT" Bigint
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table STUDENT_SUBJECT

CREATE INDEX "IX_STUDENT_TO_SUBJCET" ON "STUDENT_SUBJECT" ("STUDENT_ID")
;

CREATE INDEX "IX_SUBJECT_TO_STUDENT" ON "STUDENT_SUBJECT" ("SUBJECT_ID")
;

-- Table TEACHER_SIG

CREATE TABLE "TEACHER_SIG"(
 "BUDGET" Bigint NOT NULL,
 "SIG_ID" Bigint,
 "EMPLOYEE_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table TEACHER_SIG

CREATE INDEX "IX_TEACHER_TO_SIG" ON "TEACHER_SIG" ("EMPLOYEE_ID")
;

-- Add keys for table TEACHER_SIG

ALTER TABLE "TEACHER_SIG" ADD CONSTRAINT "Unique_Identifier14" PRIMARY KEY ("SIG_ID")
;

-- Table SPECIAL_INTERESTS_GROUP

CREATE TABLE "SPECIAL_INTERESTS_GROUP"(
 "SIG_ID" Bigint NOT NULL,
 "SUBJECT_AREA" Text NOT NULL,
 "CLASSROOM_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table SPECIAL_INTERESTS_GROUP

CREATE INDEX "IX_HELDS_SIG" ON "SPECIAL_INTERESTS_GROUP" ("CLASSROOM_ID")
;

-- Add keys for table SPECIAL_INTERESTS_GROUP

ALTER TABLE "SPECIAL_INTERESTS_GROUP" ADD CONSTRAINT "Unique_Identifier15" PRIMARY KEY ("SIG_ID")
;

-- Table STUDENT_SIG

CREATE TABLE "STUDENT_SIG"(
 "STUDENT_ID" Bigint NOT NULL,
 "SIG_ID" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Create indexes for table STUDENT_SIG

CREATE INDEX "IX_STUDENT_TO_SIG" ON "STUDENT_SIG" ("STUDENT_ID")
;

CREATE INDEX "IX_SIG_TO_STUDENT" ON "STUDENT_SIG" ("SIG_ID")
;

-- Table CLASSROOM

CREATE TABLE "CLASSROOM"(
 "CLASSROOM_ID" Bigint NOT NULL,
 "COMPLEX" Bigint NOT NULL
)
WITH (
 autovacuum_enabled=true)
;

-- Add keys for table CLASSROOM

ALTER TABLE "CLASSROOM" ADD CONSTRAINT "Unique_Identifier17" PRIMARY KEY ("CLASSROOM_ID")
;
-- Create foreign keys (relationships) section ------------------------------------------------- 

ALTER TABLE "TEACHER_TRAINING" ADD CONSTRAINT "TEACHER_TO_TRAINING" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "TEACHER" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "TEACHER_TRAINING" ADD CONSTRAINT "TRAINING_TO_TEACHER" FOREIGN KEY ("TRAINING_NAME") REFERENCES "TRAINING_COMPLETED" ("TRAINING_NAME") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "CHARGE" ADD CONSTRAINT "PAYS" FOREIGN KEY ("STUDENT_ID") REFERENCES "STUDENT" ("STUDENT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "FINAL_ASSESSMENT" ADD CONSTRAINT "IS_RATED" FOREIGN KEY ("STUDENT_ID") REFERENCES "STUDENT" ("STUDENT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "STUDENT_SUBJECT" ADD CONSTRAINT "STUDENT_TO_SUBJCET" FOREIGN KEY ("STUDENT_ID") REFERENCES "STUDENT" ("STUDENT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "STUDENT_SUBJECT" ADD CONSTRAINT "SUBJECT_TO_STUDENT" FOREIGN KEY ("SUBJECT_ID") REFERENCES "SUBJECT" ("SUBJECT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "SUBJECT" ADD CONSTRAINT "LEADS" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "TEACHER" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "STUDENT_SIG" ADD CONSTRAINT "STUDENT_TO_SIG" FOREIGN KEY ("STUDENT_ID") REFERENCES "STUDENT" ("STUDENT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "STUDENT_SIG" ADD CONSTRAINT "SIG_TO_STUDENT" FOREIGN KEY ("SIG_ID") REFERENCES "SPECIAL_INTERESTS_GROUP" ("SIG_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "TEACHER_SIG" ADD CONSTRAINT "TEACHER_TO_SIG" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "TEACHER" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "TEACHER_SIG" ADD CONSTRAINT "SIG_TO_TEACHER" FOREIGN KEY ("SIG_ID") REFERENCES "SPECIAL_INTERESTS_GROUP" ("SIG_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "SUBJECT" ADD CONSTRAINT "HELDS_SUBJECT" FOREIGN KEY ("CLASSROOM_ID") REFERENCES "CLASSROOM" ("CLASSROOM_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "SPECIAL_INTERESTS_GROUP" ADD CONSTRAINT "HELDS_SIG" FOREIGN KEY ("CLASSROOM_ID") REFERENCES "CLASSROOM" ("CLASSROOM_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "STUDENT_ADDRESS" ADD CONSTRAINT "STUDENT_LIVES" FOREIGN KEY ("STUDENT_ID") REFERENCES "STUDENT" ("STUDENT_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "EMPLOYEE_ADDRESS" ADD CONSTRAINT "EMPLOYEE_LIVES_1" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "ADMINISTRATION" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "EMPLOYEE_ADDRESS" ADD CONSTRAINT "EMPLOYEE_LIVES_2" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "MAINTENANCE" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;

ALTER TABLE "EMPLOYEE_ADDRESS" ADD CONSTRAINT "EMPLOYEE_LIVES_3" FOREIGN KEY ("EMPLOYEE_ID") REFERENCES "TEACHER" ("EMPLOYEE_ID") ON DELETE NO ACTION ON UPDATE NO ACTION
;